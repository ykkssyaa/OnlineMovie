{% extends 'base.html' %}
{% block content %}

    <h1>{{ film.name }}</h1>

    {% if film.cover %}
        <img src="{{ film.cover.url }}" alt="Обложка фильма" style="width:70%;">
    {% endif %}


        <p><strong>Дата премьеры:</strong> {{ film.premiere_date }}</p>
    <p><strong>Дата анонса:</strong> {{ film.announcement_date }}</p>
    <p><strong>Аннотация:</strong> {{ film.annotation }}</p>
    <p><strong>Для взрослых:</strong>
        {% if film.adult_content %}
            Да
        {% else %}
            Нет
        {% endif %}
    </p>
    <p><strong>Дата и время публикации:</strong> {{ film.publication_datetime }}</p>

    <p><strong>Франшиза:</strong>
        <a href="{% url 'movies:list' %}?franchise={{ film.franchise.name }}">
        {{ film.franchise }}</a>
    </p>

    {% if film.tags.all %}
        <p><strong>Теги:</strong>
            {% for tag in film.tags.all %}
                {{ tag.name }}
                {% if not forloop.last %}, {% endif %}
            {% endfor %}
        </p>
    {% endif %}

    {% if film.media_type == 'movie' %}
        <video width="1000px" height="562px" controls>
            <source src="{{ film.video_file.url }}" type="video/mp4">
        </video>
    {% endif %}


    {% if film.media_type == 'series' %}
        {% for season, episodes in episodes_by_series.items %}
            <h2>{{ season }} сезон</h2>
            <ol>
                {% for episode in episodes %}
                    <li><a href="{% url 'movies:episode_detail' episode.pk %}">{{ episode.name }}</a></li>
                {% endfor %}
            </ol>
        {% endfor %}
    {% endif %}

    {% if request.user.is_authenticated %}

        <h2>Оставь оценку</h2>
        <form method="post" action="{% url 'reviews:add_mark' film.pk %}">
            {% csrf_token %}
            {{ markForm.as_p }}
            <button type="submit">Сохранить</button>
        </form>


        {% if film in request.user.bookmarks.all %}
            <form action="{% url 'movies:remove_from_bookmarks' film.pk %}" method="post">
                {% csrf_token %}
                <button type="submit">Удалить из закладок</button>
            </form>
        {% else %}
            <form action="{% url 'movies:add_to_bookmarks' film.pk %}" method="post">
                {% csrf_token %}
                <button type="submit">Добавить в закладки</button>
            </form>
        {% endif %}


        <h2>Добавить рецензию</h2>
        <form method="post" action="{% url 'reviews:add_review' film.pk %}">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit">Сохранить</button>

        </form>

        {% if my_review %}
            <a href="{% url 'reviews:delete_review' my_review.pk %}">Удалить рецензию</a>
        {% endif %}

    {% endif %}

    <h2>Рецензии</h2>
    {% include 'elems/reviews/review_list.html' with review_list=film.review_set.all %}

{% endblock %}